import{u as p,j as n,m as y,S as W,a as e,L as l,F as L,x as M,f as F,ac as R,r as d,t as D,b as O,P as _,I as $,d as k,C as B,q as u,p as T,bm as j,aJ as H,s as b,N as V,E as X,$ as x,O as z,H as U,A as G}from"./index-2acb14b9.js";function Y(){const f=p(O),o=p(_.Settings),c=p(E),g=({amount:i})=>{const[r,A]=d.useState(!0);let s;return r&&(o!=null&&o.streamerMode)?s=parseInt("⁎".repeat(D(i,2).toString().length)).toLocaleString():s=D(i,2).toLocaleString(),s.length>15&&(s=s.slice(0,15)+"..."),e("div",{className:"value",onClick:()=>A(!r),children:f.CurrencyFormat.replace("%s",s)})};return n(y.div,{...W("left","home",.2),className:"overview",children:[e("div",{className:"wallet-header",children:e("div",{className:"title",children:l("APPS.WALLET.TITLE")})}),n("div",{className:"wrapper",children:[e("div",{className:"card"}),e("section",{children:n("div",{className:"item space",children:[n("div",{className:"balance",children:[e("div",{className:"title",children:l("APPS.WALLET.BALANCE")}),e(g,{amount:c.balance})]}),e("div",{className:"button",onClick:()=>P.set("newpayment"),children:l("APPS.WALLET.SEND")})]})}),c.recentTransactions&&c.recentTransactions.length>0&&n(L,{children:[n("div",{className:"subtitle",children:[e("div",{className:"title",children:l("APPS.WALLET.LATEST_TRANSACTIONS")}),n("div",{className:"link",onClick:()=>P.set("transactions"),children:[l("APPS.WALLET.ALL_TRANSACTIONS")," ",e(M,{})]})]}),e("section",{children:c.recentTransactions.slice(0,5).map((i,r)=>{let A=i.amount>0,s=i.company.match(/\d{10}/);return n("div",{className:"item multi",children:[i.logo?e("img",{src:i.logo}):!s&&e("div",{className:"image",children:i.company[0]}),n("div",{className:"info",children:[n("div",{className:"transaction-details",children:[e("div",{className:"title",children:s?F(i.company):i.company}),e("div",{className:"date",children:R(i.timestamp)})]}),n("div",{className:`amount ${A?"green":"red"}`,children:[!A&&"-",f.CurrencyFormat.replace("%s",Math.abs(i.amount).toLocaleString())]})]})]},r)})})]}),c.bills&&c.bills.length>0&&n(L,{children:[n("div",{className:"subtitle",children:[e("div",{className:"title",children:l("APPS.WALLET.LATEST_BILLS")}),n("div",{className:"link",children:["All Bills ",e(M,{})]})]}),e("section",{})]})]})]})}function q(){const f=p(_.Settings),o=p(O),c=p(E),[g,i]=d.useState(""),[r,A]=d.useState(0),[s,v]=d.useState(""),[w,C]=d.useState(!1),m=t=>(u("info",`Can afford? ${c.balance>=t} Balance: ${c.balance}, amount: ${t}`),c.balance>=t);d.useEffect(()=>{r===0?C(s.length>3):r===1&&C(s.length>0&&m(parseFloat(s))&&parseFloat(s)<=(o.MaxTransferAmount??Number.MAX_SAFE_INTEGER))},[s]);const S=t=>{if(t=="backspace")return v(h=>h.length>0?h.slice(0,-1):"0");v(h=>h+t)};d.useEffect(()=>{if(r!==1||s.length>=9)return;const t=document.getElementById("number");t.style.width=`${s.length}ch`},[s]);const a=t=>{B.PopUp.set({title:l(`APPS.WALLET.${t}.TITLE`),description:l(`APPS.WALLET.${t}.DESCRIPTION`),buttons:[{title:l("APPS.WALLET.OK")}]})},N=()=>{if(w){if(r==0)T("Wallet",{action:"doesNumberExist",number:s},!0).then(t=>{if(!t)return a("NUMBER_DOES_NOT_EXIST");i(s),A(h=>h+1),v("")});else if(r==1){if(!m(parseFloat(s)))return a("INSUFFICIENT_FUNDS");if(parseFloat(s)>(o.MaxTransferAmount??Number.MAX_SAFE_INTEGER))return a("Max transfer amount reached");if(f.airplaneMode)return a("AIRPLANE_MODE");T("Wallet",{action:"sendPayment",number:g,amount:Math.floor(parseFloat(s))},{success:!0}).then(t=>{t!=null&&t.success?A(h=>h+1):(u("warning","Could not send payment",t.reason),a(t.reason))})}}};return n(y.div,{...W("right","sendpayment",.25),className:"send-container",children:[n("div",{className:"send-header",children:[e("div",{onClick:()=>P.set("home"),children:r!==2&&n(L,{children:[e($,{}),l("APPS.WALLET.HOME")]})}),r===2?e("div",{onClick:()=>P.set("home"),children:l("APPS.WALLET.DONE")}):e("div",{className:!w&&"disabled",onClick:N,children:l("APPS.WALLET.NEXT")})]}),n(y.div,{...W(r!==0?"right":null,r.toString(),.25),className:"send-wrapper",children:[r===0&&n(L,{children:[e("div",{className:"user",children:e(k,{className:"number_input",type:"number",onChange:t=>v(t.target.value.replace(/[^0-9]/g,"")),value:s,placeholder:F("1234567890")})}),e("div",{className:"button",onClick:()=>{B.ContactSelector.set({onSelect:t=>{if(!(t!=null&&t.number))return u("warning","No contact found");T("Wallet",{action:"doesNumberExist",number:t.number}).then(h=>{h?(i(t.number),A(1),v("")):setTimeout(()=>a("NUMBER_DOES_NOT_EXIST"),250)})}})},children:l("APPS.WALLET.SELECT_CONTACT")}),e("div",{className:"description",children:l("APPS.WALLET.NO_REFUNDS")})]}),r===1&&n(L,{children:[n("div",{className:"amount",children:[e("div",{className:"symbol",children:o.CurrencyFormat.replace("%s","")}),e(k,{type:"number",id:"number",value:s,onChange:t=>v(t.target.value.replace(/[^0-9]/g,""))})]}),n("div",{className:"description",children:[l("APPS.WALLET.NEW_BALANCE"),": ",o.CurrencyFormat.replace("%s",""),isNaN(D(c.balance-parseFloat(s),2))?c.balance:D(c.balance-parseFloat(s),2)]})]}),r===2&&n("div",{className:"success",children:[e(j,{}),e("div",{className:"title",children:l("APPS.WALLET.DONE")}),e("div",{className:"subtitle",children:l("APPS.WALLET.DONE_SUBTITLE").format({amount:o.CurrencyFormat.replace("%s",s),number:F(g)})})]})]}),r!==2&&e("div",{className:"numpad-wrapper",children:e(H,{cb:t=>S(t)})})]})}const I={balance:10230,transactions:[{amount:-99,company:"LB",logo:"https://docs.lbscripts.com/images/icons/icon.png",timestamp:Date.now()-1e3*60*60*2},{amount:-24.45,company:"Burgershot",logo:"https://ih0.redbubble.net/image.5360028329.7056/raf,360x360,075,t,fafafa:ca443f4786.jpg",timestamp:Date.now()-1e3*60*60*6},{amount:10,company:"Breze",timestamp:Date.now()-1e3*60*60*12},{amount:-22,company:"Breze",timestamp:Date.now()-1e3*60*60*24},{amount:-99,company:"Breze",timestamp:Date.now()-1e3*60*60*24*2},{amount:3400,company:"Salary",timestamp:Date.now()-1e3*60*60*24*4},{amount:-700,company:"Invoice #1234",timestamp:Date.now()-1e3*60*60*24*4}],bills:[]};function J(){const f=p(O),o=p(b.APPS.WALLET.transactions),[c,g]=d.useState({}),[i,r]=d.useState(0),[A,s]=d.useState(!1),[v,w]=d.useState(!1);d.useEffect(()=>{o.length>0||T("Wallet",{action:"getTransactions"},I.transactions).then(m=>{if(!m)return u("warning","Failed to fetch transactions");b.APPS.WALLET.transactions.set(m)})},[]);const C=()=>{if(v||A)return u("warning","Already fetched everything or is fetching");let m=document.querySelector("#last");if(!m)return u("warning","No last element");!V(m)&&(s(!0),T("Wallet",{action:"getTransactions",page:i+1},null).then(a=>{if(!a)return u("warning","Failed to fetch transactions");a&&(a==null?void 0:a.length)>0?b.APPS.WALLET.transactions.set(a):(u("info","Fetched everything"),s(!1),w(!0))}),r(a=>a+1))};return d.useEffect(()=>{if(!o)return;const m=o.reduce((S,a)=>{let N=new Date(a.timestamp).toDateString(),t=N.split(" ").slice(1,3).join(" ");return N===new Date().toDateString()?t=l("APPS.WALLET.TODAY"):N===new Date(new Date().setDate(new Date().getDate()-1)).toDateString()&&(t=l("APPS.WALLET.YESTERDAY")),S[t]||(S[t]=[]),S[t].push(a),S},{});g(m)},[o]),n(y.div,{className:"overview",...W("right","transactions",.2),children:[n("div",{className:"wallet-header",children:[n("div",{className:"navigation",onClick:()=>P.set("home"),children:[e($,{}),l("APPS.WALLET.HOME")]}),e("div",{className:"title",children:l("APPS.WALLET.TRANSACTIONS")})]}),e("div",{className:"wrapper",onScroll:C,children:Object.keys(c).map((m,S)=>n(d.Fragment,{children:[n("div",{className:"subtitle",children:[e("div",{className:"title",children:m}),e("div",{className:"value",children:n(L,{children:[c[m].reduce((a,N)=>a+N.amount,0)>0?"+":"-",f.CurrencyFormat.replace("%s",Math.abs(c[m].reduce((a,N)=>a+N.amount,0)).toLocaleString())]})})]}),e("section",{children:c[m].map((a,N)=>{let t=a.amount>0,h=a.company.match(/\d{10}/);return n("div",{className:"item multi",children:[a.logo?e("img",{src:a.logo}):!h&&e("div",{className:"image",children:a.company[0]}),n("div",{className:"info",children:[n("div",{className:"transaction-details",children:[e("div",{className:"title",children:h?F(a.company):a.company}),e("div",{className:"date",children:R(a.timestamp)})]}),n("div",{className:`amount ${t?"green":"red"}`,children:[!t&&"-",f.CurrencyFormat.replace("%s",Math.abs(a.amount).toLocaleString())]})]})]},N)})})]},S))})]})}const P=U("home"),E=U({balance:0,recentTransactions:[],bills:[]}),K={home:e(Y,{}),transactions:e(J,{}),newpayment:e(q,{})};function Z(){const f=p(_.Settings),o=p(E),c=p(P),g=p(G);return d.useEffect(()=>{var i;X("Wallet")&&(T("Wallet",{action:"getBalance"},I.balance).then(r=>{if(!r)return u("warning","Failed to fetch balance");E.patch({balance:r})}),((i=b.APPS.WALLET.transactions)==null?void 0:i.value.length)===0&&T("Wallet",{action:"getTransactions",recent:!0},I.transactions.slice(0,5)).then(r=>{if(!r)return u("warning","Failed to fetch transactions");E.patch({recentTransactions:r})}))},[g==null?void 0:g.active]),x("wallet:addTransaction",i=>{if(f.airplaneMode)return u("warning","Cannot add transaction in airplane mode");u("info","Adding transaction",i),E.patch({recentTransactions:[i,...o.recentTransactions].slice(0,5)}),b.APPS.WALLET.transactions.set([i,...o.recentTransactions])}),x("wallet:setBalance",i=>{if(f.airplaneMode)return u("warning","Cannot add transaction in airplane mode");if(!i)return u("warning","Failed to fetch balance");u("info","Setting balance",i),E.patch({balance:i})}),e("div",{className:"wallet-app-container",children:e(z,{children:K[c]})})}export{P as View,E as WalletInfo,Z as default};
