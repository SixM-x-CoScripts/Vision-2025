import{u as f,r as h,p as v,q as N,a as e,F as D,j as i,m as L,c6 as ie,L as n,av as J,k as B,bD as oe,C as A,c7 as ce,az as re,c0 as le,am as de,b as x,$,I as me,f as M,a1 as Se,d as Pe,bU as W,a5 as Ee,t as X,N as ue,a8 as z,a9 as pe,A as Y,ac as G,P as w,w as he,e as K,g as Ce,h as ee,D as Q,H as q,bC as te,c8 as ve,c9 as Z,O as ae,J as Ie,i as Ne,S as ne,a0 as ge,x as fe,ca as be}from"./index-2acb14b9.js";const _={companies:[{job:"police",name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png",canCall:!0,canMessage:!0,bossRanks:["boss","lieutenant"],open:!0,location:{name:"Mission Row",coords:{x:428.9,y:-984.5}}},{job:"ambulance",name:"Ambulance",icon:"https://cdn-icons-png.flaticon.com/128/1032/1032989.png",canCall:!0,canMessage:!0,bossRanks:["boss","doctor"],open:!0,location:{name:"Pillbox",coords:{x:304.2,y:-587}}},{job:"mechanic",name:"Mechanic",icon:"https://cdn-icons-png.flaticon.com/128/10281/10281554.png",canCall:!0,canMessage:!0,bossRanks:["boss","worker"],open:!1,location:{name:"LS Customs",coords:{x:-336.6,y:-134.3}}},{job:"taxi",name:"Taxi",icon:"https://cdn-icons-png.flaticon.com/128/433/433449.png",canCall:!0,canMessage:!0,bossRanks:["boss","driver"],open:!1,location:{name:"Taxi HQ",coords:{x:984.2,y:-219}}}],company:{job:"police",duty:!0,receiveCalls:!0,isBoss:!0,balance:1e6,employees:[{id:1,name:"Breze",grade:1,gradeLabel:"Officer",canInteract:!0,online:!0},{id:2,name:"Loaf Scripts",grade:2,gradeLabel:"Sergeant",canInteract:!0,online:!0},{id:3,name:"Kash",grade:3,gradeLabel:"Lieutenant",canInteract:!0,online:!1}],grades:[{label:"Officer",grade:1},{label:"Sergeant",grade:2},{label:"Lieutenant",grade:3},{label:"Captain",grade:4}]},messageList:[{id:"1",lastMessage:"Is anyone available to help me?",sender:"Breze",number:"1234567890",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*2},{id:"2",lastMessage:"Hello, how can i help you?",sender:"Loaf Scripts",number:"4802940940",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*4},{id:"3",lastMessage:"Hey, i need backup at the bank",sender:"Sally",number:"2051440412",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*24*2}],messages:{1:[{id:"1",sender:"1234567890",content:"Is anyone available to help me?",timestamp:Date.now()-1e3*60*60*2},{id:"2",sender:"1234567323",content:"Hey, a unit is on its way to your location",timestamp:Date.now()-1e3*60*60*24*2},{id:"3",sender:"1234567890",content:"i'd like to report a crime, i'm at the pier",timestamp:Date.now()-1e3*60*60*24*2}],2:[{id:"1",sender:"4802940940",content:"Hey, can you help me?",timestamp:Date.now()-1e3*60*60*4},{id:"2",sender:"4802940940",content:"I need a unit to my location",timestamp:Date.now()-1e3*60*60*24*5},{id:"3",sender:"4802940940",content:"I need backup at the bank",timestamp:Date.now()-1e3*60*60*24*9}],3:[{id:"1",sender:"2051440412",content:"is there any way you have any job positions available?",timestamp:Date.now()-1e3*60*60*24*2},{id:"2",sender:"2051440412",content:"hello?",timestamp:Date.now()-1e3*60*60*24*4},{id:"3",sender:"2051440412",content:"hey, i have a question",timestamp:Date.now()-1e3*60*60*24*5}]},employees:[{firstname:"John",lastname:"Doe",grade:1,gradeLabel:"Officer",number:"1234567890",online:!0},{firstname:"Loaf",lastname:"Scripts",grade:2,gradeLabel:"Sergeant",number:"4802940940",online:!0},{firstname:"Kash",grade:3,gradeLabel:"Lieutenant",number:"2051440412",online:!1},{firstname:"Sally",grade:4,gradeLabel:"Captain",number:"1234567323",online:!0}]};function Ae(){var E,o,p,u,O,g,R,l,b,U,k,m,C;const t=f(x),[a,s]=h.useState(null),[P,d]=h.useState(null);h.useEffect(()=>{v("Services",{action:"getCompany"},_.company).then(c=>{if(!c)return N("warning","Failed to fetch company data");s(c)})},[]);const r=()=>{A.PopUp.set({title:n("APPS.SERVICES.DEPOSIT_POPUP.TITLE"),description:n("APPS.SERVICES.DEPOSIT_POPUP.DESCRIPTION"),input:{placeholder:n("APPS.SERVICES.DEPOSIT_POPUP.AMOUNT"),onChange:c=>{d(c)},type:"number"},buttons:[{title:n("APPS.SERVICES.DEPOSIT_POPUP.CANCEL")},{title:n("APPS.SERVICES.DEPOSIT_POPUP.PROCEED"),cb:()=>{d(c=>{/^\d+$/.test(c)&&v("Services",{action:"depositMoney",amount:parseInt(c)},parseInt(c)+a.balance).then(I=>{if(typeof I!="number")return N("warning","Balance is not a number, not updating");s({...a,balance:I})})})}}]})},S=()=>{A.PopUp.set({title:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:n("APPS.SERVICES.WITHDRAW_POPUP.DESCRIPTION"),input:{placeholder:n("APPS.SERVICES.WITHDRAW_POPUP.AMOUNT"),onChange:c=>{d(c)},type:"number"},buttons:[{title:n("APPS.SERVICES.WITHDRAW_POPUP.CANCEL")},{title:n("APPS.SERVICES.WITHDRAW_POPUP.PROCEED"),cb:()=>{d(c=>{if(/^\d+$/.test(c)){if(a.balance-parseInt(c)<0){A.PopUp.set({title:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:n("APPS.SERVICES.WITHDRAW_POPUP.NOT_ENOUGH_MONEY").format({amount:c}),buttons:[{title:n("APPS.SERVICES.WITHDRAW_POPUP.PROCEED")}]});return}v("Services",{action:"withdrawMoney",amount:parseInt(c)},a.balance-parseInt(c)).then(I=>{if(typeof I!="number")return N("warning","Balance is not a number, not updating");s({...a,balance:I})})}})}}]})};return e(D,{children:a!=null&&a.job?i("div",{className:"actions-container",children:[e("div",{className:"category-title",children:"Settings"}),e("section",{children:i(D,{children:[a.duty!==void 0&&((o=(E=t==null?void 0:t.Companies)==null?void 0:E.Management)==null?void 0:o.Duty)!==!1&&i(L.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[e(ie,{className:"orange"}),i("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.DUTY")}),e("div",{className:"description",children:n("APPS.SERVICES.DUTY_DESCRIPTION")})]})]}),e("div",{className:"item-value",children:e(J,{checked:a.duty,onChange:()=>{v("Services",{action:"toggleDuty",duty:!a.duty},!0).then(()=>s({...a,duty:!a.duty}))}})})]}),(a.duty===void 0||a.duty===!0)&&i(L.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[e(B,{className:"green"}),i("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.JOB_CALLS")}),i("div",{className:"description",children:[" ",n("APPS.SERVICES.JOB_CALLS_DESCRIPTION").format({toggle:a.receiveCalls?n("APPS.SERVICES.DISABLE"):n("APPS.SERVICES.ENABLE")})]})]})]}),e("div",{className:"item-value",children:e(J,{checked:a.receiveCalls,onChange:()=>{v("Services",{action:"toggleCalls"},!a.receiveCalls).then(c=>{s({...a,receiveCalls:c})})}})})]})]})}),a.isBoss&&i(D,{children:[e("div",{className:"category-title",children:n("APPS.SERVICES.ACTIONS")}),i("section",{children:[i(L.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[e(oe,{className:"green"}),i("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.BALANCE")}),e("div",{className:"description",children:"Current balance of the company"})]})]}),e("div",{className:"item-value",children:t.CurrencyFormat.replace("%s",(p=a.balance)==null?void 0:p.toLocaleString())})]}),(((O=(u=t==null?void 0:t.Companies)==null?void 0:u.Management)==null?void 0:O.Deposit)!==!1||((R=(g=t==null?void 0:t.Companies)==null?void 0:g.Management)==null?void 0:R.Withdraw)!==!1)&&i("div",{className:"item",children:[((b=(l=t==null?void 0:t.Companies)==null?void 0:l.Management)==null?void 0:b.Deposit)!==!1&&e("div",{className:"button",onClick:r,children:n("APPS.SERVICES.DEPOSIT_POPUP.TITLE")}),((k=(U=t==null?void 0:t.Companies)==null?void 0:U.Management)==null?void 0:k.Withdraw)!==!1&&e("div",{className:"button",onClick:S,children:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE")})]})]}),e("div",{className:"category-title",children:n("APPS.SERVICES.MANAGE_EMPLOYEES")}),i("section",{children:[((C=(m=t==null?void 0:t.Companies)==null?void 0:m.Management)==null?void 0:C.Hire)!==!1&&i(L.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{A.PopUp.set({title:n("APPS.SERVICES.HIRE_POPUP.TITLE"),description:n("APPS.SERVICES.HIRE_POPUP.DESCRIPTION"),input:{type:"number",placeholder:n("APPS.SERVICES.HIRE_POPUP.PLACEHOLDER"),onChange:c=>{d(c)}},buttons:[{title:n("APPS.SERVICES.HIRE_POPUP.CANCEL")},{title:n("APPS.SERVICES.HIRE_POPUP.PROCEED"),cb:()=>{d(c=>{if(/^\d+$/.test(c))return v("Services",{action:"hireEmployee",source:parseInt(c)},{id:c,name:"Joe Doe"}).then(I=>{I&&s({...a,employees:[...a.employees,{id:I.id,name:I.name,grade:0,gradeLabel:a.grades[0].label,canInteract:!0}]})}),""})}}]})},children:[i("div",{className:"item-data",children:[e(ce,{className:"blue"}),i("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.HIRE")}),e("div",{className:"description",children:n("APPS.SERVICES.HIRE_POPUP.DESCRIPTION")})]})]}),e("div",{className:"item-value",children:e(re,{})})]}),a.employees.map((c,I)=>i(L.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{if(!c.canInteract||t.Companies.Management.Fire===!1&&t.Companies.Management.Promote===!1)return;const se=[t.Companies.Management.Promote!==!1&&{title:n("APPS.SERVICES.SET_GRADE"),cb:()=>{setTimeout(()=>{A.ContextMenu.set({buttons:[...a.grades.map(T=>({title:T.label,cb:()=>{v("Services",{action:"setGrade",employee:c.id,grade:T.grade},!0).then(F=>{if(!F)return N("warning","Failed to set grade");s({...a,employees:a.employees.map(H=>(H.id===c.id&&(H.grade=T.grade,H.gradeLabel=T.label),H))})})}}))]})},300)}},t.Companies.Management.Fire!==!1&&{title:n("APPS.SERVICES.FIRE_POPUP.TITLE"),color:"red",cb:()=>{A.PopUp.set({title:n("APPS.SERVICES.FIRE_POPUP.TITLE"),description:n("APPS.SERVICES.FIRE_POPUP.DESCRIPTION").format({name:c.name}),buttons:[{title:n("APPS.SERVICES.FIRE_POPUP.CANCEL")},{title:n("APPS.SERVICES.FIRE_POPUP.PROCEED"),color:"red",cb:()=>{v("Services",{action:"fireEmployee",employee:c.id},!0).then(T=>{if(!T)return N("warning","Failed to fire employee");s({...a,employees:a.employees.filter(F=>F.id!==c.id)})})}}]})}}];A.ContextMenu.set({buttons:se.filter(T=>T)})},children:[i("div",{className:"item-data",children:[e(le,{}),i("div",{className:"item-info",children:[e("div",{className:"title",children:c.name}),i("div",{className:"description",children:[" ",c.gradeLabel]})]})]}),i("div",{className:"item-value",children:[e("div",{className:"status","data-online":c.online}),e(de,{})]})]},I))]})]})]}):e("div",{className:"no-job",children:n("APPS.SERVICES.UNEMPLOYED")})})}function Oe(){const t=f(w.Settings),a=f(w.PhoneNumber),s=f(y),[P,d]=h.useState(0),[r,S]=h.useState(!1),[E,o]=h.useState(!1),[p,u]=h.useState([]),O=h.useRef(null),[g,R]=h.useState({content:"",attachments:[]});h.useEffect(()=>{v("Services",{action:"getMessages",page:0,id:s.id,company:s.job},_.messages[s.id]).then(m=>{if(m&&m.length>0){u([...m.reverse()]);let C=document.querySelector(".chat-container");C.scrollTop=C.scrollHeight}else S(!0)})},[]);const l=()=>{if(g.content.length>0){let m={sender:a,id:s.id,company:s.job,content:g.content,timestamp:new Date};if(t.airplaneMode)return u(C=>[...C,{...m,delivered:!1}]);v("Services",{action:"sendMessage",...m},!0).then(C=>{C||N("error","Failed to send message"),u(c=>[...c,{...m,delivered:C}]),R({content:"",attachments:[]}),O.current.value=""})}},b=()=>{A.PopUp.set({title:n("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:n("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:n("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:n("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{v("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(m=>{if(!m)return N("error","Failed to get location");let C={sender:a,content:`<!SENT-LOCATION-X=${X(m.x,2)}Y=${X(m.y,2)}!>`,attachments:[],id:s.id,company:s.job,timestamp:new Date};v("Services",{action:"sendMessage",...C},!0).then(c=>{u(c?I=>[...I,C]:I=>[...I,{...C,delivered:!1}])})})}}]})},U=()=>{if(r||E)return;let m=document.querySelector("#last");if(!m)return;!ue(m)&&(o(!0),v("Services",{action:"getMessages",page:P+1,id:s.id,company:s.job},null).then(c=>{c&&c.length>0?(u([...c.reverse(),...p]),o(!1),c.length<25&&S(!0)):S(!0)}),d(c=>c+1))};$("services:newMessage",m=>{if(s.id!==m.channelId||m.sender===a||t.airplaneMode)return;u([...p,{...m,timestamp:new Date}]);let C=document.querySelector(".chat-container");C.scrollTop=C.scrollHeight});const k=m=>{if(m)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(m)};return i(D,{children:[i("div",{className:"chat-header",children:[e("div",{className:"back",onClick:()=>{V.set("messages"),y.reset()},children:e(me,{})}),i("div",{className:"user",children:[e("img",{src:s.icon??`./assets/img/avatar-placeholder-${t.display.theme}.svg`,className:"avatar"}),e("div",{className:"name",children:s.company??M(s.number)})]}),e(Se,{className:"hidden"})]}),e("div",{className:"chat-container",onScroll:U,children:e("div",{className:"chat-body",children:p.map((m,C)=>e(Re,{index:C,messages:p,message:m,func:{isLocation:k}}))})}),e("div",{className:"chat-bottom",children:i("div",{className:"input",children:[e(Pe,{placeholder:n("APPS.MESSAGES.PLACEHOLDER"),ref:O,value:g.content,onChange:m=>{R({content:m.target.value,attachments:g.attachments})},onKeyDown:m=>{m.key=="Enter"&&l()}}),i("div",{className:"buttons",children:[e("div",{className:"location",children:e(W,{onClick:b})}),g.content.length>0&&e("div",{className:"send",onClick:l,children:e(Ee,{})})]})]})})]})}const Re=({messages:t,message:a,index:s,func:P})=>{var g;const d=f(w.PhoneNumber),r=f(y);let S,E,o,p=s===0?"last":"",u=a.sender===d?"self":"other",O=((g=t[s+1])==null?void 0:g.sender)===d?"self":"other";if(t[s+1]?E=Math.abs(a.timestamp-t[s+1].timestamp)/36e5:O=void 0,P.isLocation(a.content)){let R=a.content.match(/X=(-?\d*\.?\d*)Y/)[1],l=a.content.match(/Y=(-?\d*\.?\d*)!>/)[1];o={x:R,y:l}}return i("div",{className:`message ${u}`,id:p,"data-id":a.id,children:[S,a.delivered===!1?i("div",{className:"content-wrapper",children:[e("div",{className:"content",children:z(a.content)}),e(pe,{})]}):o?i("div",{className:"location",onClick:()=>{Y.patch({active:{name:"Maps",data:{location:[o.y,o.x],name:`${M(a.sender)}'s location`,icon:r.icon}}})},children:[e("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}}),u==="other"&&i("div",{className:"sender",children:[M(a.sender)," ",n("APPS.MESSAGES.SENT_LOCATION")]})]}):a.content&&e("div",{className:"content",children:z(a.content)}),a.delivered===!1?e("div",{className:"status",children:n("APPS.MESSAGES.NOT_DELIVERED")}):t[s+1]&&E>6?e("div",{className:"date",children:G(a.timestamp)}):u!==O&&e("div",{className:"date",children:G(a.timestamp)})]},s)},j=q(!1);function Le(){const t=f(j),[a,s]=h.useState([]),[P,d]=h.useState("all"),[r,S]=h.useState("");h.useEffect(()=>{v("Services",{action:"getEmployees",company:t},_.employees).then(o=>{if(!o)return N("warning","Failed to fetch employees");s(o)})},[]);const E=o=>{if(!o)return N("error","No number provided");A.PopUp.set({title:n("APPS.SERVICES.CALL_POPUP.TITLE"),description:n("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:M(o)}),buttons:[{title:n("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:n("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{let p=Q(o);E({...p,number:o})}}]})};return i(L.div,{initial:{opacity:0,y:250},animate:{opacity:1,y:0},exit:{opacity:0,y:250},transition:{duration:.2,ease:"easeInOut"},className:"employee-list",children:[i("div",{className:"employee-list-header",children:[e("div",{className:"close",onClick:()=>j.set(!1)}),e("div",{className:"selector",children:["all","available"].map((o,p)=>e("div",{className:"option","data-active":P===o,onClick:()=>d(o),children:n(`APPS.SERVICES.${o.toUpperCase()}`)},p))}),e(he,{placeholder:n("APPS.SERVICES.SEARCH_EMPLOYEES"),onChange:o=>S(o.target.value)})]}),e("div",{className:"employee-list-body",children:a.filter(o=>(P==="all"?!0:o.online)&&K(o.firstname,o.lastname).toLowerCase().includes(r.toLowerCase())).sort((o,p)=>p.grade-o.grade).map((o,p)=>i(L.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"employee-item",children:[i("div",{className:"user",children:[e("div",{className:"avatar",children:Ce(o.firstname,o.lastname)}),i("div",{className:"info",children:[K(o.firstname,o.lastname),e("span",{children:o.gradeLabel})]})]}),e("div",{className:"buttons",children:i(D,{children:[e(B,{className:o.online&&o.number?"green":"red",onClick:()=>E(o.number)}),e(ee,{className:o.online&&o.number?"green":"red",onClick:()=>{if(!o.number)return N("error","No number provided");let u=Q(o.number);Y.patch({active:{name:"Messages",data:{number:o.number,name:u==null?void 0:u.name,avatar:u==null?void 0:u.avatar,view:"messages"}}})}})]})})]},p))})]})}function Te(){const[t,a]=h.useState([]);return h.useEffect(()=>{v("Services",{action:"getCompanies"},_.companies).then(s=>{if(!s)return N("warning","Failed to fetch companies");a(s)})},[]),$("services:updateOpen",s=>{if(!s)return;const{job:P,open:d}=s;a(r=>{const S=r.findIndex(E=>E.job===P);return S===-1?r:(r[S].open=d,[...r])})}),e(D,{children:e("div",{className:"companies-list",children:t.sort((s,P)=>s.open&&!P.open?-1:!s.open&&P.open?1:0).map(s=>e(ye,{company:s},s.name))})})}const ye=({company:t})=>{var o,p,u,O,g,R;const a=f(x),s=((o=a.Companies)==null?void 0:o.SeeEmployees)==="everyone"||((p=a.Companies)==null?void 0:p.SeeEmployees)==="employees"&&t.job==="police",[P,d]=h.useState(!1),r=l=>{var b;!((b=l==null?void 0:l.location)!=null&&b.coords)||!l.name||Y.patch({active:{name:"Maps",data:{location:[l.location.coords.y,l.location.coords.x],name:l.name,icon:l.icon}}})},S=(l,b)=>{a.Companies.Enabled&&A.PopUp.set({title:n("APPS.SERVICES.CALL_POPUP.TITLE"),description:n("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:Ie(l)}),buttons:[{title:n("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:n("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{Ne({company:l,companylabel:b})}}]})},E=l=>{v("Services",{action:"getChannelId",company:l.job},"1").then(b=>{if(!b)return N("error","Failed to get channel id");y.set({icon:l.icon,company:l.name,job:l.job,id:b}),V.set("chat")})};return i("div",{className:"item",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),"data-open":t.open,style:{cursor:s?"pointer":"default"},onClick:()=>{s&&j.set(t.job)},children:[i("div",{className:"info",children:[t.icon&&e("div",{className:"icon",children:e("img",{src:t.icon})}),i("div",{className:"company-details",children:[e("div",{className:"title",children:t.name}),i("div",{className:"location",children:[e(te,{}),(u=t.location)==null?void 0:u.name]})]})]}),t.open?i("div",{className:"actions",children:[t.customIcon&&e("div",{className:"custom-icon",onClick:l=>{l.stopPropagation(),v("Services",{action:"customIconClick",company:t.job})},children:ve[t.customIcon]()}),((O=t.location)==null?void 0:O.coords)&&e(W,{className:"orange",onClick:l=>{l.stopPropagation(),r(t)}}),((g=a.Companies)==null?void 0:g.Enabled)!==!1&&t.canCall!==!1&&e(B,{className:"green",onClick:l=>{l.stopPropagation(),S(t.job,t.name)}}),t.canMessage!==!1&&e(Z,{className:"green",onClick:l=>{l.stopPropagation(),E(t)}})]}):i(D,{children:[i("div",{className:"actions",onMouseEnter:()=>d(!1),onMouseLeave:()=>d(!0),children:[((R=t.location)==null?void 0:R.coords)&&e(W,{className:"orange",onClick:l=>{l.stopPropagation(),r(t)}}),t.canMessage!==!1&&a.Companies.MessageOffline&&e(Z,{className:"green",onClick:l=>{l.stopPropagation(),E(t)}})]}),e(ae,{children:P&&e(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},className:"closed",children:n("APPS.SERVICES.CLOSED")})})]})]},t.name)};function De(){const t=f(w.PhoneNumber),[a,s]=h.useState({personal:[],job:[]}),[P,d]=h.useState("personal");return h.useEffect(()=>{v("Services",{action:"getRecentMessages",page:0},_.messageList).then(r=>{if(!r)return N("warning","No recent messages found");s({personal:[...r.filter(S=>S.number===t)],job:[...r.filter(S=>S.number!==t)]})})},[]),$("services:channelDeleted",r=>{if(!r)return N("error","No channel ID provided");s({personal:a.personal.filter(S=>S.id!==r),job:a.job.filter(S=>S.id!==r)})}),e(D,{children:i("div",{className:"company-messages-container",children:[e("div",{className:"company-messages-header",children:e("div",{className:"selector",children:["personal","job"].map((r,S)=>e("div",{className:"option","data-active":P===r,onClick:()=>d(r),children:n(`APPS.SERVICES.${r.toUpperCase()}`)},S))})}),e(L.section,{...ne(P==="personal"?"right":"left",P,.2),children:(a==null?void 0:a[P])&&(a==null?void 0:a[P].map((r,S)=>e(Me,{channel:r,type:P},S)))})]})})}const Me=({channel:t,type:a})=>{var r,S;const s=f(w.Settings),P=ge(()=>{var E;(E=x)!=null&&E.value.Companies.DeleteConversations&&a!=="personal"&&A.ContextMenu.set({buttons:[{title:n("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),color:"red",cb:()=>{setTimeout(()=>{A.PopUp.set({title:n("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),description:n("APPS.MESSAGES.DELETE_CONVERSATION.DESCRIPTION"),buttons:[{title:n("APPS.MESSAGES.DELETE_CONVERSATION.CANCEL")},{title:n("APPS.MESSAGES.DELETE_CONVERSATION.DELETE"),color:"red",cb:()=>{v("Services",{action:"deleteChannel",id:t.id},!0).then(o=>{if(!o)return N("error","Failed to delete channel, deleteChannel returned false")})}}]})},100)}}]})}),d=E=>{if(E)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(E)};return i("div",{...P,className:"item",onClick:()=>{var E,o,p;y.set({...y==null?void 0:y.value,id:t.id,icon:a==="personal"&&((E=t==null?void 0:t.company)!=null&&E.icon)?t.company.icon:`./assets/img/avatar-placeholder-${s.display.theme}.svg`,company:a==="personal"&&((o=t==null?void 0:t.company)!=null&&o.name)?t.company.name:M(t.number),job:(p=t.company)==null?void 0:p.job,number:t.number}),V.set("chat")},children:[a==="personal"&&((r=t==null?void 0:t.company)!=null&&r.icon)?e("img",{src:t.company.icon}):e("img",{src:`./assets/img/avatar-placeholder-${s.display.theme}.svg`}),i("div",{className:"info",children:[i("div",{className:"info-header",children:[e("div",{className:"user",children:a==="personal"&&((S=t==null?void 0:t.company)!=null&&S.name)?t.company.name:M(t.number)}),i("div",{className:"right",children:[e("div",{className:"time",children:G(t.timestamp)}),e(fe,{})]})]}),e("div",{className:"message",children:d(t.lastMessage)?n("APPS.MESSAGES.SENT_LOCATION_SHORT"):t.lastMessage})]})]})};function Ve(){const t=f(x),a=f(V),[s,P]=h.useState([{icon:e(te,{}),title:n("APPS.SERVICES.COMPANIES"),value:"companies"},{icon:e(ee,{}),title:n("APPS.SERVICES.MESSAGES"),value:"messages"}]);return h.useEffect(()=>{var d,r;((r=(d=t==null?void 0:t.Companies)==null?void 0:d.Management)==null?void 0:r.Enabled)!==!1&&P([...s,{icon:e(be,{}),title:n("APPS.SERVICES.ACTIONS"),value:"actions"}])},[]),e("div",{className:"companies-footer",children:s.map((d,r)=>i("div",{className:"item","data-active":a===d.value,onClick:()=>V.set(d.value),children:[d.icon,d.title]},r))})}const V=q("companies"),y=q(null);function _e(){const t=f(V),a=f(j),s={companies:e(Te,{}),actions:e(Ae,{}),messages:e(De,{}),chat:e(Oe,{})};let P={actions:n("APPS.SERVICES.ACTIONS"),messages:n("APPS.SERVICES.MESSAGES"),companies:n("APPS.SERVICES.COMPANIES")};return i("div",{className:"companies-container","data-view":t,children:[e(ae,{children:a&&e(Le,{})}),i(L.div,{...ne(t==="chat"?"left":"right",t,.2),className:"companies-wrapper",children:[t!=="chat"&&e("div",{className:"companies-header",children:e("div",{className:"title",children:P[t]})}),e("div",{className:"companies-body",children:s[t]})]}),t!=="chat"&&e(Ve,{})]})}export{y as Data,V as View,_e as default};
