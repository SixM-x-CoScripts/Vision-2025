import{u as f,r as h,p as v,q as N,a as e,F as T,j as i,L as n,m as R,c5 as ie,au as X,k as $,bC as oe,C as A,c6 as ce,ay as re,b$ as le,ak as de,b as x,_ as Y,I as me,f as V,a0 as Se,d as Pe,bT as W,a4 as Ee,t as J,K as ue,a7 as K,a8 as pe,A as F,ab as B,P as U,w as he,e as z,g as Ce,h as ee,D as Q,H as q,E as ve,bB as te,c7 as Ie,c8 as Z,N as ae,aB as Ne,i as ge,S as ne,$ as fe,x as be,c9 as Ae}from"./index-5c9d4bf6.js";const _={companies:[{job:"police",name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png",canCall:!0,canMessage:!0,bossRanks:["boss","lieutenant"],open:!0,location:{name:"Mission Row",coords:{x:428.9,y:-984.5}}},{job:"ambulance",name:"Ambulance",icon:"https://cdn-icons-png.flaticon.com/128/1032/1032989.png",canCall:!0,canMessage:!0,bossRanks:["boss","doctor"],open:!0,location:{name:"Pillbox",coords:{x:304.2,y:-587}}},{job:"mechanic",name:"Mechanic",icon:"https://cdn-icons-png.flaticon.com/128/10281/10281554.png",canCall:!0,canMessage:!0,bossRanks:["boss","worker"],open:!1,location:{name:"LS Customs",coords:{x:-336.6,y:-134.3}}},{job:"taxi",name:"Taxi",icon:"https://cdn-icons-png.flaticon.com/128/433/433449.png",canCall:!0,canMessage:!0,bossRanks:["boss","driver"],open:!1,location:{name:"Taxi HQ",coords:{x:984.2,y:-219}}}],company:{job:"police",duty:!0,receiveCalls:!0,isBoss:!0,balance:1e6,employees:[{id:1,name:"Breze",grade:1,gradeLabel:"Officer",canInteract:!0,online:!0},{id:2,name:"Loaf Scripts",grade:2,gradeLabel:"Sergeant",canInteract:!0,online:!0},{id:3,name:"Kash",grade:3,gradeLabel:"Lieutenant",canInteract:!0,online:!1}],grades:[{label:"Officer",grade:1},{label:"Sergeant",grade:2},{label:"Lieutenant",grade:3},{label:"Captain",grade:4}]},messageList:[{id:"1",lastMessage:"Is anyone available to help me?",sender:"Breze",number:"1234567890",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*2},{id:"2",lastMessage:"Hello, how can i help you?",sender:"Loaf Scripts",number:"4802940940",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*4},{id:"3",lastMessage:"Hey, i need backup at the bank",sender:"Sally",number:"2051440412",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*24*2}],messages:{1:[{id:"1",sender:"1234567890",content:"Is anyone available to help me?",timestamp:Date.now()-1e3*60*60*2},{id:"2",sender:"1234567323",content:"Hey, a unit is on its way to your location",timestamp:Date.now()-1e3*60*60*24*2},{id:"3",sender:"1234567890",content:"i'd like to report a crime, i'm at the pier",timestamp:Date.now()-1e3*60*60*24*2}],2:[{id:"1",sender:"4802940940",content:"Hey, can you help me?",timestamp:Date.now()-1e3*60*60*4},{id:"2",sender:"4802940940",content:"I need a unit to my location",timestamp:Date.now()-1e3*60*60*24*5},{id:"3",sender:"4802940940",content:"I need backup at the bank",timestamp:Date.now()-1e3*60*60*24*9}],3:[{id:"1",sender:"2051440412",content:"is there any way you have any job positions available?",timestamp:Date.now()-1e3*60*60*24*2},{id:"2",sender:"2051440412",content:"hello?",timestamp:Date.now()-1e3*60*60*24*4},{id:"3",sender:"2051440412",content:"hey, i have a question",timestamp:Date.now()-1e3*60*60*24*5}]},employees:[{firstname:"John",lastname:"Doe",grade:1,gradeLabel:"Officer",number:"1234567890",online:!0},{firstname:"Loaf",lastname:"Scripts",grade:2,gradeLabel:"Sergeant",number:"4802940940",online:!0},{firstname:"Kash",grade:3,gradeLabel:"Lieutenant",number:"2051440412",online:!1},{firstname:"Sally",grade:4,gradeLabel:"Captain",number:"1234567323",online:!0}]};function Oe(){var P,s,u,p,O,b,d,I,D,M,k,m,C;const t=f(x),[a,o]=h.useState(null),[E,r]=h.useState(null);h.useEffect(()=>{v("Services",{action:"getCompany"},_.company).then(c=>{if(!c)return N("warning","Failed to fetch company data");o(c)})},[]);const l=()=>{A.PopUp.set({title:n("APPS.SERVICES.DEPOSIT_POPUP.TITLE"),description:n("APPS.SERVICES.DEPOSIT_POPUP.DESCRIPTION"),input:{placeholder:n("APPS.SERVICES.DEPOSIT_POPUP.AMOUNT"),onChange:c=>{r(c)},type:"number"},buttons:[{title:n("APPS.SERVICES.DEPOSIT_POPUP.CANCEL")},{title:n("APPS.SERVICES.DEPOSIT_POPUP.PROCEED"),cb:()=>{r(c=>{/^\d+$/.test(c)&&v("Services",{action:"depositMoney",amount:parseInt(c)},parseInt(c)+a.balance).then(g=>{if(typeof g!="number")return N("warning","Balance is not a number, not updating");o({...a,balance:g})})})}}]})},S=()=>{A.PopUp.set({title:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:n("APPS.SERVICES.WITHDRAW_POPUP.DESCRIPTION"),input:{placeholder:n("APPS.SERVICES.WITHDRAW_POPUP.AMOUNT"),onChange:c=>{r(c)},type:"number"},buttons:[{title:n("APPS.SERVICES.WITHDRAW_POPUP.CANCEL")},{title:n("APPS.SERVICES.WITHDRAW_POPUP.PROCEED"),cb:()=>{r(c=>{if(/^\d+$/.test(c)){if(a.balance-parseInt(c)<0){A.PopUp.set({title:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:n("APPS.SERVICES.WITHDRAW_POPUP.NOT_ENOUGH_MONEY").format({amount:c}),buttons:[{title:n("APPS.SERVICES.WITHDRAW_POPUP.PROCEED")}]});return}v("Services",{action:"withdrawMoney",amount:parseInt(c)},a.balance-parseInt(c)).then(g=>{if(typeof g!="number")return N("warning","Balance is not a number, not updating");o({...a,balance:g})})}})}}]})};return e(T,{children:a!=null&&a.job?i("div",{className:"actions-container",children:[e("div",{className:"category-title",children:n("APPS.SERVICES.SETTINGS")}),e("section",{children:i(T,{children:[a.duty!==void 0&&((s=(P=t==null?void 0:t.Companies)==null?void 0:P.Management)==null?void 0:s.Duty)!==!1&&i(R.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[e(ie,{className:"orange"}),i("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.DUTY")}),e("div",{className:"description",children:n("APPS.SERVICES.DUTY_DESCRIPTION")})]})]}),e("div",{className:"item-value",children:e(X,{checked:a.duty,onChange:()=>{v("Services",{action:"toggleDuty",duty:!a.duty},!0).then(()=>o({...a,duty:!a.duty}))}})})]}),(a.duty===void 0||a.duty===!0)&&i(R.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[e($,{className:"green"}),i("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.JOB_CALLS")}),i("div",{className:"description",children:[" ",n("APPS.SERVICES.JOB_CALLS_DESCRIPTION").format({toggle:a.receiveCalls?n("APPS.SERVICES.DISABLE"):n("APPS.SERVICES.ENABLE")})]})]})]}),e("div",{className:"item-value",children:e(X,{checked:a.receiveCalls,onChange:()=>{v("Services",{action:"toggleCalls"},!a.receiveCalls).then(c=>{o({...a,receiveCalls:c})})}})})]})]})}),a.isBoss&&i(T,{children:[e("div",{className:"category-title",children:n("APPS.SERVICES.ACTIONS")}),i("section",{children:[i(R.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[e(oe,{className:"green"}),i("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.BALANCE")}),e("div",{className:"description",children:"Current balance of the company"})]})]}),e("div",{className:"item-value",children:t.CurrencyFormat.replace("%s",(u=a.balance)==null?void 0:u.toLocaleString())})]}),(((O=(p=t==null?void 0:t.Companies)==null?void 0:p.Management)==null?void 0:O.Deposit)!==!1||((d=(b=t==null?void 0:t.Companies)==null?void 0:b.Management)==null?void 0:d.Withdraw)!==!1)&&i("div",{className:"item",children:[((D=(I=t==null?void 0:t.Companies)==null?void 0:I.Management)==null?void 0:D.Deposit)!==!1&&e("div",{className:"button",onClick:l,children:n("APPS.SERVICES.DEPOSIT_POPUP.TITLE")}),((k=(M=t==null?void 0:t.Companies)==null?void 0:M.Management)==null?void 0:k.Withdraw)!==!1&&e("div",{className:"button",onClick:S,children:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE")})]})]}),e("div",{className:"category-title",children:n("APPS.SERVICES.MANAGE_EMPLOYEES")}),i("section",{children:[((C=(m=t==null?void 0:t.Companies)==null?void 0:m.Management)==null?void 0:C.Hire)!==!1&&i(R.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{A.PopUp.set({title:n("APPS.SERVICES.HIRE_POPUP.TITLE"),description:n("APPS.SERVICES.HIRE_POPUP.DESCRIPTION"),input:{type:"number",placeholder:n("APPS.SERVICES.HIRE_POPUP.PLACEHOLDER"),onChange:c=>{r(c)}},buttons:[{title:n("APPS.SERVICES.HIRE_POPUP.CANCEL")},{title:n("APPS.SERVICES.HIRE_POPUP.PROCEED"),cb:()=>{r(c=>{if(/^\d+$/.test(c))return v("Services",{action:"hireEmployee",source:parseInt(c)},{id:c,name:"Joe Doe"}).then(g=>{g&&o({...a,employees:[...a.employees,{id:g.id,name:g.name,grade:0,gradeLabel:a.grades[0].label,canInteract:!0}]})}),""})}}]})},children:[i("div",{className:"item-data",children:[e(ce,{className:"blue"}),i("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.HIRE")}),e("div",{className:"description",children:n("APPS.SERVICES.HIRE_POPUP.DESCRIPTION")})]})]}),e("div",{className:"item-value",children:e(re,{})})]}),a.employees.map((c,g)=>i(R.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{if(!c.canInteract||t.Companies.Management.Fire===!1&&t.Companies.Management.Promote===!1)return;const se=[t.Companies.Management.Promote!==!1&&{title:n("APPS.SERVICES.SET_GRADE"),cb:()=>{setTimeout(()=>{A.ContextMenu.set({buttons:[...a.grades.map(L=>({title:L.label,cb:()=>{v("Services",{action:"setGrade",employee:c.id,grade:L.grade},!0).then(G=>{if(!G)return N("warning","Failed to set grade");o({...a,employees:a.employees.map(j=>(j.id===c.id&&(j.grade=L.grade,j.gradeLabel=L.label),j))})})}}))]})},300)}},t.Companies.Management.Fire!==!1&&{title:n("APPS.SERVICES.FIRE_POPUP.TITLE"),color:"red",cb:()=>{A.PopUp.set({title:n("APPS.SERVICES.FIRE_POPUP.TITLE"),description:n("APPS.SERVICES.FIRE_POPUP.DESCRIPTION").format({name:c.name}),buttons:[{title:n("APPS.SERVICES.FIRE_POPUP.CANCEL")},{title:n("APPS.SERVICES.FIRE_POPUP.PROCEED"),color:"red",cb:()=>{v("Services",{action:"fireEmployee",employee:c.id},!0).then(L=>{if(!L)return N("warning","Failed to fire employee");o({...a,employees:a.employees.filter(G=>G.id!==c.id)})})}}]})}}];A.ContextMenu.set({buttons:se.filter(L=>L)})},children:[i("div",{className:"item-data",children:[e(le,{}),i("div",{className:"item-info",children:[e("div",{className:"title",children:c.name}),i("div",{className:"description",children:[" ",c.gradeLabel]})]})]}),i("div",{className:"item-value",children:[e("div",{className:"status","data-online":c.online}),e(de,{})]})]},g))]})]})]}):e("div",{className:"no-job",children:n("APPS.SERVICES.UNEMPLOYED")})})}function Re(){const t=f(U.Settings),a=f(U.PhoneNumber),o=f(y),[E,r]=h.useState(0),[l,S]=h.useState(!1),[P,s]=h.useState(!1),[u,p]=h.useState([]),O=h.useRef(null),[b,d]=h.useState({content:"",attachments:[]});h.useEffect(()=>{v("Services",{action:"getMessages",page:0,id:o.id,company:o.job},_.messages[o.id]).then(m=>{if(m&&m.length>0){p([...m.reverse()]);let C=document.querySelector(".chat-container");C.scrollTop=C.scrollHeight}else S(!0)})},[]);const I=()=>{if(b.content.length>0){let m={sender:a,id:o.id,company:o.job,content:b.content,timestamp:new Date};if(t.airplaneMode)return p(C=>[...C,{...m,delivered:!1}]);v("Services",{action:"sendMessage",...m},!0).then(C=>{C||N("error","Failed to send message"),p(c=>[...c,{...m,delivered:C}]),d({content:"",attachments:[]}),O.current.value=""})}},D=()=>{A.PopUp.set({title:n("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:n("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:n("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:n("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{v("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(m=>{if(!m)return N("error","Failed to get location");let C={sender:a,content:`<!SENT-LOCATION-X=${J(m.x,2)}Y=${J(m.y,2)}!>`,attachments:[],id:o.id,company:o.job,timestamp:new Date};v("Services",{action:"sendMessage",...C},!0).then(c=>{p(c?g=>[...g,C]:g=>[...g,{...C,delivered:!1}])})})}}]})},M=()=>{if(l||P)return;let m=document.querySelector("#last");if(!m)return;!ue(m)&&(s(!0),v("Services",{action:"getMessages",page:E+1,id:o.id,company:o.job},null).then(c=>{c&&c.length>0?(p([...c.reverse(),...u]),s(!1),c.length<25&&S(!0)):S(!0)}),r(c=>c+1))};Y("services:newMessage",m=>{if(o.id!==m.channelId||m.sender===a||t.airplaneMode)return;p([...u,{...m,timestamp:new Date}]);let C=document.querySelector(".chat-container");C.scrollTop=C.scrollHeight});const k=m=>{if(m)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(m)};return i(T,{children:[i("div",{className:"chat-header",children:[e("div",{className:"back",onClick:()=>{w.set("messages"),y.reset()},children:e(me,{})}),i("div",{className:"user",children:[e("img",{src:o.icon??`./assets/img/avatar-placeholder-${t.display.theme}.svg`,className:"avatar"}),e("div",{className:"name",children:o.company??V(o.number)})]}),e(Se,{className:"hidden"})]}),e("div",{className:"chat-container",onScroll:M,children:e("div",{className:"chat-body",children:u.map((m,C)=>e(Le,{index:C,messages:u,message:m,func:{isLocation:k}}))})}),e("div",{className:"chat-bottom",children:i("div",{className:"input",children:[e(Pe,{placeholder:n("APPS.MESSAGES.PLACEHOLDER"),ref:O,value:b.content,onChange:m=>{d({content:m.target.value,attachments:b.attachments})},onKeyDown:m=>{m.key=="Enter"&&I()}}),i("div",{className:"buttons",children:[e("div",{className:"location",children:e(W,{onClick:D})}),b.content.length>0&&e("div",{className:"send",onClick:I,children:e(Ee,{})})]})]})})]})}const Le=({messages:t,message:a,index:o,func:E})=>{var b;const r=f(U.PhoneNumber),l=f(y);let S,P,s,u=o===0?"last":"",p=a.sender===r?"self":"other",O=((b=t[o+1])==null?void 0:b.sender)===r?"self":"other";if(t[o+1]?P=Math.abs(a.timestamp-t[o+1].timestamp)/36e5:O=void 0,E.isLocation(a.content)){let d=a.content.match(/X=(-?\d*\.?\d*)Y/)[1],I=a.content.match(/Y=(-?\d*\.?\d*)!>/)[1];s={x:d,y:I}}return i("div",{className:`message ${p}`,id:u,"data-id":a.id,children:[S,a.delivered===!1?i("div",{className:"content-wrapper",children:[e("div",{className:"content",children:K(a.content)}),e(pe,{})]}):s?i("div",{className:"location",onClick:()=>{F.patch({active:{name:"Maps",data:{location:[s.y,s.x],name:`${V(a.sender)}'s location`,icon:l.icon}}})},children:[e("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}}),p==="other"&&i("div",{className:"sender",children:[V(a.sender)," ",n("APPS.MESSAGES.SENT_LOCATION")]})]}):a.content&&e("div",{className:"content",children:K(a.content)}),a.delivered===!1?e("div",{className:"status",children:n("APPS.MESSAGES.NOT_DELIVERED")}):t[o+1]&&P>6?e("div",{className:"date",children:B(a.timestamp)}):p!==O&&e("div",{className:"date",children:B(a.timestamp)})]},o)},H=q(!1);function ye(){const t=f(H),[a,o]=h.useState([]),[E,r]=h.useState("all"),[l,S]=h.useState("");h.useEffect(()=>{v("Services",{action:"getEmployees",company:t},_.employees).then(s=>{if(!s)return N("warning","Failed to fetch employees");o(s)})},[]);const P=s=>{if(!s)return N("error","No number provided");A.PopUp.set({title:n("APPS.SERVICES.CALL_POPUP.TITLE"),description:n("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:V(s)}),buttons:[{title:n("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:n("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{let u=Q(s);P({...u,number:s})}}]})};return i(R.div,{initial:{opacity:0,y:250},animate:{opacity:1,y:0},exit:{opacity:0,y:250},transition:{duration:.2,ease:"easeInOut"},className:"employee-list",children:[i("div",{className:"employee-list-header",children:[e("div",{className:"close",onClick:()=>H.set(!1)}),e("div",{className:"selector",children:["all","available"].map((s,u)=>e("div",{className:"option","data-active":E===s,onClick:()=>r(s),children:n(`APPS.SERVICES.${s.toUpperCase()}`)},u))}),e(he,{placeholder:n("APPS.SERVICES.SEARCH_EMPLOYEES"),onChange:s=>S(s.target.value)})]}),e("div",{className:"employee-list-body",children:a.filter(s=>(E==="all"?!0:s.online)&&z(s.firstname,s.lastname).toLowerCase().includes(l.toLowerCase())).sort((s,u)=>u.grade-s.grade).map((s,u)=>i(R.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"employee-item",children:[i("div",{className:"user",children:[e("div",{className:"avatar",children:Ce(s.firstname,s.lastname)}),i("div",{className:"info",children:[z(s.firstname,s.lastname),e("span",{children:s.gradeLabel})]})]}),e("div",{className:"buttons",children:i(T,{children:[e($,{className:s.online&&s.number?"green":"red",onClick:()=>P(s.number)}),e(ee,{className:s.online&&s.number?"green":"red",onClick:()=>{if(!s.number)return N("error","No number provided");let p=Q(s.number);F.patch({active:{name:"Messages",data:{number:s.number,name:p==null?void 0:p.name,avatar:p==null?void 0:p.avatar,view:"messages"}}})}})]})})]},u))})]})}function Te(){var E;const[t,a]=h.useState([]),o=(E=f(F))==null?void 0:E.active;return h.useEffect(()=>{ve("Services")&&v("Services",{action:"getCompanies"},_.companies).then(r=>{if(!r)return N("warning","Failed to fetch companies");a(r)})},[o]),Y("services:updateOpen",r=>{if(!r)return;const{job:l,open:S}=r;a(P=>{const s=P.findIndex(u=>u.job===l);return s===-1?P:(P[s].open=S,[...P])})}),e(T,{children:e("div",{className:"companies-list",children:t.sort((r,l)=>r.open&&!l.open?-1:!r.open&&l.open?1:0).map(r=>e(De,{company:r},r.name))})})}const De=({company:t})=>{var u,p,O,b;const a=f(x),[o,E]=h.useState(!1);h.useEffect(()=>{v("Services",{action:"getCompany"},_.company).then(d=>{var D,M;if(!d)return N("warning","Failed to fetch company data");let I=d.job;E(((D=a.Companies)==null?void 0:D.SeeEmployees)==="everyone"||((M=a.Companies)==null?void 0:M.SeeEmployees)==="employees"&&t.job===I)})},[]);const[r,l]=h.useState(!1),S=d=>{var I;!((I=d==null?void 0:d.location)!=null&&I.coords)||!d.name||F.patch({active:{name:"Maps",data:{location:[d.location.coords.y,d.location.coords.x],name:d.name,icon:d.icon}}})},P=(d,I)=>{a.Companies.Enabled&&A.PopUp.set({title:n("APPS.SERVICES.CALL_POPUP.TITLE"),description:n("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:Ne(d)}),buttons:[{title:n("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:n("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{ge({company:d,companylabel:I})}}]})},s=d=>{v("Services",{action:"getChannelId",company:d.job},"1").then(I=>{if(!I)return N("error","Failed to get channel id");y.set({icon:d.icon,company:d.name,job:d.job,id:I}),w.set("chat")})};return i("div",{className:"item",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),"data-open":t.open,style:{cursor:o?"pointer":"default"},onClick:()=>{o&&H.set(t.job)},children:[i("div",{className:"info",children:[t.icon&&e("div",{className:"icon",children:e("img",{src:t.icon})}),i("div",{className:"company-details",children:[e("div",{className:"title",children:t.name}),i("div",{className:"location",children:[e(te,{}),(u=t.location)==null?void 0:u.name]})]})]}),t.open?i("div",{className:"actions",children:[t.customIcon&&e("div",{className:"custom-icon",onClick:d=>{d.stopPropagation(),v("Services",{action:"customIconClick",company:t.job})},children:Ie[t.customIcon]()}),((p=t.location)==null?void 0:p.coords)&&e(W,{className:"orange",onClick:d=>{d.stopPropagation(),S(t)}}),((O=a.Companies)==null?void 0:O.Enabled)!==!1&&t.canCall!==!1&&e($,{className:"green",onClick:d=>{d.stopPropagation(),P(t.job,t.name)}}),t.canMessage!==!1&&e(Z,{className:"green",onClick:d=>{d.stopPropagation(),s(t)}})]}):i(T,{children:[i("div",{className:"actions",onMouseEnter:()=>l(!1),onMouseLeave:()=>l(!0),children:[((b=t.location)==null?void 0:b.coords)&&e(W,{className:"orange",onClick:d=>{d.stopPropagation(),S(t)}}),t.canMessage!==!1&&a.Companies.MessageOffline&&e(Z,{className:"green",onClick:d=>{d.stopPropagation(),s(t)}})]}),e(ae,{children:r&&e(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},className:"closed",children:n("APPS.SERVICES.CLOSED")})})]})]},t.name)};function Me(){const t=f(U.PhoneNumber),[a,o]=h.useState({personal:[],job:[]}),[E,r]=h.useState("personal");return h.useEffect(()=>{v("Services",{action:"getRecentMessages",page:0},_.messageList).then(l=>{if(!l)return N("warning","No recent messages found");o({personal:[...l.filter(S=>S.number===t)],job:[...l.filter(S=>S.number!==t)]})})},[]),Y("services:channelDeleted",l=>{if(!l)return N("error","No channel ID provided");o({personal:a.personal.filter(S=>S.id!==l),job:a.job.filter(S=>S.id!==l)})}),e(T,{children:i("div",{className:"company-messages-container",children:[e("div",{className:"company-messages-header",children:e("div",{className:"selector",children:["personal","job"].map((l,S)=>e("div",{className:"option","data-active":E===l,onClick:()=>r(l),children:n(`APPS.SERVICES.${l.toUpperCase()}`)},S))})}),e(R.section,{...ne(E==="personal"?"right":"left",E,.2),children:(a==null?void 0:a[E])&&(a==null?void 0:a[E].map((l,S)=>e(Ve,{channel:l,type:E},S)))})]})})}const Ve=({channel:t,type:a})=>{var l,S;const o=f(U.Settings),E=fe(()=>{var P;(P=x)!=null&&P.value.Companies.DeleteConversations&&a!=="personal"&&A.ContextMenu.set({buttons:[{title:n("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),color:"red",cb:()=>{setTimeout(()=>{A.PopUp.set({title:n("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),description:n("APPS.MESSAGES.DELETE_CONVERSATION.DESCRIPTION"),buttons:[{title:n("APPS.MESSAGES.DELETE_CONVERSATION.CANCEL")},{title:n("APPS.MESSAGES.DELETE_CONVERSATION.DELETE"),color:"red",cb:()=>{v("Services",{action:"deleteChannel",id:t.id},!0).then(s=>{if(!s)return N("error","Failed to delete channel, deleteChannel returned false")})}}]})},100)}}]})}),r=P=>{if(P)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(P)};return i("div",{...E,className:"item",onClick:()=>{var P,s,u;y.set({...y==null?void 0:y.value,id:t.id,icon:a==="personal"&&((P=t==null?void 0:t.company)!=null&&P.icon)?t.company.icon:`./assets/img/avatar-placeholder-${o.display.theme}.svg`,company:a==="personal"&&((s=t==null?void 0:t.company)!=null&&s.name)?t.company.name:V(t.number),job:(u=t.company)==null?void 0:u.job,number:t.number}),w.set("chat")},children:[a==="personal"&&((l=t==null?void 0:t.company)!=null&&l.icon)?e("img",{src:t.company.icon}):e("img",{src:`./assets/img/avatar-placeholder-${o.display.theme}.svg`}),i("div",{className:"info",children:[i("div",{className:"info-header",children:[e("div",{className:"user",children:a==="personal"&&((S=t==null?void 0:t.company)!=null&&S.name)?t.company.name:V(t.number)}),i("div",{className:"right",children:[e("div",{className:"time",children:B(t.timestamp)}),e(be,{})]})]}),e("div",{className:"message",children:r(t.lastMessage)?n("APPS.MESSAGES.SENT_LOCATION_SHORT"):t.lastMessage})]})]})};function we(){const t=f(x),a=f(w),[o,E]=h.useState([{icon:e(te,{}),title:n("APPS.SERVICES.COMPANIES"),value:"companies"},{icon:e(ee,{}),title:n("APPS.SERVICES.MESSAGES"),value:"messages"}]);return h.useEffect(()=>{var r,l;((l=(r=t==null?void 0:t.Companies)==null?void 0:r.Management)==null?void 0:l.Enabled)!==!1&&E([...o,{icon:e(Ae,{}),title:n("APPS.SERVICES.ACTIONS"),value:"actions"}])},[]),e("div",{className:"companies-footer",children:o.map((r,l)=>i("div",{className:"item","data-active":a===r.value,onClick:()=>w.set(r.value),children:[r.icon,r.title]},l))})}const w=q("companies"),y=q(null);function Ue(){const t=f(w),a=f(H),o={companies:e(Te,{}),actions:e(Oe,{}),messages:e(Me,{}),chat:e(Re,{})};let E={actions:n("APPS.SERVICES.ACTIONS"),messages:n("APPS.SERVICES.MESSAGES"),companies:n("APPS.SERVICES.COMPANIES")};return i("div",{className:"companies-container","data-view":t,children:[e(ae,{children:a&&e(ye,{})}),i(R.div,{...ne(t==="chat"?"left":"right",t,.2),className:"companies-wrapper",children:[t!=="chat"&&e("div",{className:"companies-header",children:e("div",{className:"title",children:E[t]})}),e("div",{className:"companies-body",children:o[t]})]}),t!=="chat"&&e(we,{})]})}export{y as Data,w as View,Ue as default};
