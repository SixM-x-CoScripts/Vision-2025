import{r as n,u as E,s as g,p as S,C as R,L as P,a7 as U,q as C,j as m,a as i,w as $,H as G,E as b,m as k,d as L,ac as _,F as H,O as j,n as B,bN as Y,Q as K,R as W,bO as q,T as Q,P as x,U as z,A as J,t as X}from"./index-2acb14b9.js";import{A as Z}from"./audioRecorder-b9544cbe.js";const ee={voiceMemos:[{id:1,title:"Voice Memo 1",timestamp:Date.now()-1e3*60*60*2,duration:1,src:"https://loaf-scripts.com/fivem/lb-phone/mockdata/one.mp3"},{id:2,title:"Birds Chirping",timestamp:Date.now()-1e3*60*60*5,duration:22,src:"https://loaf-scripts.com/fivem/lb-phone/mockdata/birds-chirping.mp3"}]};const F=G(null);function se(){n.useRef(null);const f=n.useRef(null),[o,d]=n.useState(""),[M,s]=n.useState(!1),c=E(g.APPS.VOICEMEMO.voicememos);n.useEffect(()=>(f.current=new Z,g.APPS.DARKCHAT.channels.value||S("VoiceMemo",{action:"get"},ee.voiceMemos).then(t=>{g.APPS.VOICEMEMO.voicememos.set(t)}),()=>{f.current&&f.current.stop()}),[]);const I=()=>{let t=P("APPS.VOICEMEMO.DEFAULT_NAME"),r=c.map(a=>{let u=a.title;if(u.startsWith(t)){let l=u.split(" ");if(l.length>1&&/^\d+$/.test(l[l.length-1]))return parseInt(l[l.length-1])}return null}).filter(a=>a!==null).sort((a,u)=>a-u);if(r.length===0)return c.some(a=>a.title===t)?t+" 2":t;for(let a=0;a<r.length;a++)if(r[a]!==a+2)return t+" "+(a+2);return t+" "+(r[r.length-1]+1)},A=async t=>{};return n.useEffect(()=>{if(!M||!f.current)return;const t=f.current;return t.start(100,A),()=>{t.stop().then(async r=>{if(!r){R.PopUp.set({title:P("APPS.VOICEMEMO.EMPTY_RECORDING_POPUP.TITLE"),description:P("APPS.VOICEMEMO.EMPTY_RECORDING_POPUP.DESCRIPTION"),buttons:[{title:P("APPS.VOICEMEMO.EMPTY_RECORDING_POPUP.OK")}]});return}let a;try{a=await U("Audio",r.blob)}catch(V){C("error","Failed to upload voice memo",V);return}const u=I(),l=await S("VoiceMemo",{action:"upload",data:{src:a,duration:r.duration,title:u}},Math.floor(Math.random()*100).toString());l&&(g.APPS.VOICEMEMO.voicememos.set([{id:l,title:u,timestamp:new Date().getTime(),duration:r.duration,src:a},...c]),C("info",`Saved voice memo ${l}`))})}},[M]),m("div",{className:"voicememo-container",children:[m("div",{className:"voicememo-wrapper",children:[i("div",{className:"title",children:P("APPS.VOICEMEMO.VOICE_RECORDINGS")}),i($,{placeholder:P("APPS.VOICEMEMO.SEARCH_RECORDINGS"),onChange:t=>d(t.target.value)}),i("div",{className:"voicememo-items",children:c.filter(t=>t.title.toLowerCase().includes(o.toLowerCase())).sort((t,r)=>r.timestamp-t.timestamp).map(t=>i(te,{data:t,delete:()=>g.APPS.VOICEMEMO.voicememos.set(c.filter(r=>r.id!==t.id))},t.id))})]}),i("div",{className:"voicememo-footer",children:i("div",{className:"button-record",onClick:()=>s(!M),children:i("div",{className:"button-inner","data-recording":M})})})]})}const te=f=>{const{data:o}=f,d=E(x.Settings),M=E(g.APPS.VOICEMEMO.voicememos),s=n.useRef(null),[c,I]=n.useState(!1),[A,t]=n.useState(!1),[r,a]=n.useState(0),u=E(F),[l,V]=n.useState(o.title),[ie,D]=n.useState(!1),[h,w]=n.useState(null),O=E(z),y=E(J);E(x.PhoneNumber),n.useEffect(()=>(s.current=new Audio(o.src),s.current.src=o.src,s.current.volume=d.sound.volume??.5,s.current.addEventListener("ended",()=>{t(!1)}),s.current.addEventListener("timeupdate",()=>{a(s.current.currentTime)}),()=>{var e,p;(e=s.current)==null||e.pause(),(p=s.current)==null||p.remove(),s.current=null}),[]),n.useEffect(()=>{var e;(O!=null&&O.visible||!b("VoiceMemo"))&&((e=s.current)==null||e.pause(),t(!1))},[O==null?void 0:O.visible,y==null?void 0:y.active]),n.useEffect(()=>{var e;u&&u!==o.id&&((e=s.current)==null||e.pause(),t(!1),I(!1))},[u]),n.useEffect(()=>{d.sound.volume&&(s.current.volume=d.sound.volume)},[d.sound.volume]),n.useEffect(()=>{t(!1),a(0),c&&F.set(o.id)},[c]);const T=e=>{const p=Math.floor(e/60),v=X(e-p*60,0);return`${p}:${v<10?"0"+v:v}`},N={light:{active:"#333333",slider:"#cccccc"},dark:{active:"#FFFFFF",slider:"#999999"}};return m(k.div,{className:"voicememo-item",initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},onClick:()=>I(!c),"data-expanded":c,children:[c?i(L,{className:"voicememo-title",defaultValue:l,onClick:e=>e.stopPropagation(),onLoad:e=>{e.target.style.width=e.target.value.length+"ch"},onChange:e=>{V(e.target.value),e.target.style.width=e.target.value.length+"ch"},onBlur:e=>{S("VoiceMemo",{action:"rename",id:o.id,title:e.target.value},!0).then(p=>{if(!p)return C("warning","Failed to rename voice memo");g.APPS.VOICEMEMO.voicememos.set(M.map(v=>v.id===o.id?{...v,title:e.target.value}:v))})}}):i("div",{className:"voicememo-title",children:l}),c&&i("div",{className:"subtitle",children:_(o.timestamp)}),m("div",{className:"voicememo-info",children:[!c&&m(H,{children:[i("div",{className:"date",children:_(o.timestamp)}),i("div",{className:"duration",children:T(o.duration)})]}),i(j,{children:c&&m(k.div,{className:"voicememo-actions",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[m("div",{className:"voicememo-duration-slider",onClick:e=>e.stopPropagation(),children:[i(L,{type:"range",min:0,max:100,value:h||r/o.duration*100,style:{background:`linear-gradient(to right, ${N[d.display.theme].active} 0%, ${N[d.display.theme].active} ${h||r/o.duration*100}%, ${N[d.display.theme].slider} ${h||r/o.duration*100}%, ${N[d.display.theme].slider} 100%)`},onMouseDown:e=>{b("VoiceMemo")&&(e.stopPropagation(),D(!0))},onMouseUp:e=>{if(e.stopPropagation(),D(!1),h){if(!s.current)return C("warning","Audio ref is null");s.current.currentTime=o.duration/100*h,w(null)}},onChange:e=>{e.stopPropagation(),w(e.target.value)}}),m("div",{className:"duration",children:[i("div",{children:T(r)??"0:00"}),i("div",{children:T(o.duration)})]})]}),m("div",{className:"voicememo-item-footer",children:[i("div",{className:"share",children:i(B,{onClick:e=>{e.stopPropagation(),R.Share.set({type:"voicememo",data:o})}})}),m("div",{className:"controls",children:[i(Y,{className:"disabled"}),i("span",{onClick:e=>{if(e.stopPropagation(),!s.current)return C("warning","Audio ref is null");A?(s.current.pause(),t(!1)):(s.current.play(),t(!0))},children:A?i(K,{}):i(W,{})}),i(q,{className:"disabled"})]}),i("div",{className:"delete",children:i(Q,{onClick:e=>{e.stopPropagation(),R.PopUp.set({title:P("APPS.VOICEMEMO.DELETE_POPUP.TITLE"),description:P("APPS.VOICEMEMO.DELETE_POPUP.DESCRIPTION"),buttons:[{title:P("APPS.VOICEMEMO.DELETE_POPUP.CANCEL")},{title:P("APPS.VOICEMEMO.DELETE_POPUP.PROCEED"),color:"red",cb:()=>{S("VoiceMemo",{action:"delete",id:o.id}).then(p=>{if(!p)return C("warning","Failed to delete voice memo");f.delete()})}}]})}})})]})]})})]})]})};export{se as default};
